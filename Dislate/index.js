(function(h,S,g,t,I,_,c,d,U,L,b,$,B,v){"use strict";const G="https://translate.googleapis.com/translate_a/single";var C={translate:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"auto",a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=G+"?"+new URLSearchParams({client:"gtx",sl:r,tl:a,dt:"t",dj:"1",q:e});try{if(i)return{source_lang:r,text:e};const l=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}),y=await l.json();if(l.status!==200)throw Error(`Failed to translate text from google translate: ${l.statusText}`);return{source_lang:r,text:y.sentences[0].trans}}catch(l){throw Error(`Failed to fetch translation from google translate: ${l}`)}}};const D=g.findByProps("openLazy","hideActionSheet"),O=g.findByProps("ActionSheetRow")?.ActionSheetRow??d.Forms.FormRow,F=g.findByStoreName("MessageStore"),k=g.findByStoreName("ChannelStore"),H=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:_.semanticColors.INTERACTIVE_NORMAL}});let f=[];function j(){return I.before("openLazy",D,function(e){let[r,a,i]=e;const n=i?.message;a!=="MessageLongPressActionSheet"||!n||r.then(function(l){const y=I.after("default",l,function(ce,ne){t.React.useEffect(function(){return function(){y()}},[]);const N=U.findInReactTree(ne,function(s){return s?.[0]?.type?.name==="ButtonRow"});if(!N)return;const ae=Math.max(N.findIndex(function(s){return s.props.message===t.i18n.Messages.MARK_UNREAD}),0),u=F.getMessage(n.channel_id,n.id);if(!u?.content&&!n.content)return;const R=u?.id??n.id,re=u?.content??n.content,m=f.find(function(s){return Object.keys(s)[0]===R},"cache object"),A=m?"Revert":"Translate",x=A==="Translate"?c.getAssetIDByName("ic_locale_24px"):c.getAssetIDByName("ic_highlight"),ie=async function(){try{const s=o.target_lang,T=A==="Translate",se=await C.translate(u.content,void 0,s,!T);t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...u,content:`${T?se.text:m[R]} ${T?`\`[${s?.toLowerCase()}]\``:""}`,guild_id:k.getChannel(u.channel_id).guild_id},log_edit:!1}),T?f.unshift({[R]:re}):f=f.filter(function(oe){return oe!==m},"cached data override")}catch(s){v.showToast("Failed to translate message. Please check Debug Logs for more info.",c.getAssetIDByName("Small")),L.logger.error(s)}finally{return D.hideActionSheet()}};N.splice(ae,0,t.React.createElement(O,{label:`${A} Message`,icon:t.React.createElement(O.Icon,{source:x,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:H.iconComponent,source:x})}}),onPress:ie}))})})})}var V=function(e){return e[e.BUILT_IN=0]="BUILT_IN",e[e.BUILT_IN_TEXT=1]="BUILT_IN_TEXT",e[e.BUILT_IN_INTEGRATION=2]="BUILT_IN_INTEGRATION",e[e.BOT=3]="BOT",e[e.PLACEHOLDER=4]="PLACEHOLDER",e}({}),w=function(e){return e[e.SUB_COMMAND=1]="SUB_COMMAND",e[e.SUB_COMMAND_GROUP=2]="SUB_COMMAND_GROUP",e[e.STRING=3]="STRING",e[e.INTEGER=4]="INTEGER",e[e.BOOLEAN=5]="BOOLEAN",e[e.USER=6]="USER",e[e.CHANNEL=7]="CHANNEL",e[e.ROLE=8]="ROLE",e[e.MENTIONABLE=9]="MENTIONABLE",e[e.NUMBER=10]="NUMBER",e[e.ATTACHMENT=11]="ATTACHMENT",e}({}),z=function(e){return e[e.CHAT=1]="CHAT",e[e.USER=2]="USER",e[e.MESSAGE=3]="MESSAGE",e}({}),M={arabic:"AR",bulgarian:"BG",czech:"CS",danish:"DA",german:"DE",greek:"EL",english:"EN",spanish:"ES",estonian:"ET",finnish:"FI",french:"FR",hungarian:"HU",indonesian:"ID",italian:"IT",japanese:"JA",korean:"KO",lithuanian:"LT",latvian:"LV",norwegian:"NO",dutch:"NL",polish:"PL",portuguese:"PT",romanian:"RO",russian:"RU",slovak:"SK",slovenian:"SL",swedish:"SV",turkish:"TR",ukrainian:"UK","chinese-simplified":"ZH"};const K=g.findByProps("sendBotMessage"),q=Object.entries(M).map(function(e){let[r,a]=e;return{name:r,displayName:r,value:a}});function X(){return b.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",displayDescription:"Send a message using Dislate in any language chosen, using the DeepL Translate API.",applicationId:"-1",type:z.CHAT,inputType:V.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:w.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:w.STRING,choices:[...q],required:!0}],async execute(e,r){const[a,i]=e;try{const n=await C.translate(a.value,null,i.value);return await new Promise(function(l){return $.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(d.Codeblock,null,n.text),confirmText:"Yep, send it!",onConfirm:function(){return l({content:n.text})},cancelText:"Nope, don't send it"})})}catch(n){return L.logger.error(n),K.sendBotMessage(r.channel.id,"Failed to translate message. Please check Debug Logs for more info.",c.getAssetIDByName("Small"))}}})}const{FormRow:E}=d.Forms,{ScrollView:Y}=t.ReactNative;function J(){B.useProxy(o);const[e,r]=t.React.useState("");return t.React.createElement(Y,{style:{flex:1}},t.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(a){r(a)}}),Object.entries(M).filter(function(a){let[i,n]=a;return i.includes(e)}).map(function(a){let[i,n]=a;return t.React.createElement(E,{label:i,trailing:function(){return t.React.createElement(E.Arrow,null)},onPress:function(){o.target_lang!=n&&(o.target_lang=n,v.showToast(`Saved ToLang to ${i}`,c.getAssetIDByName("check")))}})}))}const{ScrollView:Z,Text:Q}=t.ReactNative,{FormRow:p}=d.Forms,W=t.stylesheet.createThemedStyleSheet({subheaderText:{color:_.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14}});function ee(){const e=t.NavigationNative.useNavigation();return B.useProxy(o),t.React.createElement(Z,null,t.React.createElement(p,{label:"Translate to",subLabel:o.target_lang?.toLowerCase(),leading:t.React.createElement(p.Icon,{source:c.getAssetIDByName("ic_activity_24px")}),trailing:function(){return t.React.createElement(p.Arrow,null)},onPress:function(){return e.push("VendettaCustomPage",{title:"Translate to",render:J})}}),t.React.createElement(Q,{style:W.subheaderText,onPress:function(){return t.url.openURL("https://github.com/aeongdesu/vdplugins")}},`Build: (${S.manifest.hash.substring(0,7)})`))}const o=S.storage;o.target_lang??(o.target_lang="EN");let P=[];var te={onLoad:function(){return P=[j(),X()]},onUnload:function(){for(const e of P)e()},settings:ee};return h.default=te,h.settings=o,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
